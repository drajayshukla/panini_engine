import re
import unicodedata


def sanskrit_varna_vichhed(text):
    """
    ‡§™‡§æ‡§£‡§ø‡§®‡•Ä‡§Ø ‡§Ö‡§∑‡•ç‡§ü‡§æ‡§ß‡•ç‡§Ø‡§æ‡§Ø‡•Ä-‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§ ‡§µ‡§∞‡•ç‡§£-‡§µ‡§ø‡§ö‡•ç‡§õ‡•á‡§¶
    ‡§≤‡•ã / ‡§≤‡•Ä / ‡§≤‡•Ç / ‡§ü‡•Ä / ‡§Æ‡•á / ‡§ï‡§ø ‚Äî ‡§∏‡§¨ ‡§∏‡§π‡•Ä
    """

    if not text:
        return []

    # üî• FIX 1: Unicode normalization (‡§≤ ‡§ï‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡§æ ‡§Ö‡§∏‡§≤‡•Ä ‡§ï‡§æ‡§∞‡§£)
    text = unicodedata.normalize("NFC", text)

    # ‡§®‡§ø‡§Ø‡§Æ 16: ‡•ê ‡§ï‡§æ ‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§µ‡§ø‡§ö‡•ç‡§õ‡•á‡§¶
    if text == "‡•ê":
        return ["‡§Ö", "‡§â", "‡§Æ‡•ç"]

    # ‡§®‡§ø‡§Ø‡§Æ 3, 12, 13: ‡§∏‡§Ç‡§Ø‡•Å‡§ï‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞ + ‡§Ö‡§µ‡§ó‡•ç‡§∞‡§π
    text = (
        text.replace('‡§ï‡•ç‡§∑', '‡§ï‡•ç‚Äå‡§∑')
            .replace('‡§§‡•ç‡§∞', '‡§§‡•ç‚Äå‡§∞')
            .replace('‡§ú‡•ç‡§û', '‡§ú‡•ç‚Äå‡§û')
            .replace('‡§∂‡•ç‡§∞', '‡§∂‡•ç‚Äå‡§∞')
            .replace('‡§Ω', '‡§Ö')
    )

    # ‡§®‡§ø‡§Ø‡§Æ 6‚Äì7: ‡§™‡§û‡•ç‡§ö‡§Æ ‡§µ‡§∞‡•ç‡§£ / ‡§Ö‡§®‡•Å‡§∏‡•ç‡§µ‡§æ‡§∞
    text = re.sub(r'‡§Ç(?=[‡§ï‡§ñ‡§ó‡§ò])', '‡§ô‡•ç', text)
    text = re.sub(r'‡§Ç(?=[‡§ö‡§õ‡§ú‡§ù])', '‡§û‡•ç', text)
    text = re.sub(r'‡§Ç(?=[‡§ü‡§†‡§°‡§¢])', '‡§£‡•ç', text)
    text = re.sub(r'‡§Ç(?=[‡§§‡§•‡§¶‡§ß])', '‡§®‡•ç', text)
    text = re.sub(r'‡§Ç(?=[‡§™‡§´‡§¨‡§≠])', '‡§Æ‡•ç', text)

    if text.endswith('‡§Ç'):
        text = text[:-1] + '‡§Æ‡•ç'

    # ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ ‚Üí ‡§∏‡•ç‡§µ‡§§‡§Ç‡§§‡•ç‡§∞ ‡§∏‡•ç‡§µ‡§∞
    vowels_map = {
        '‡§æ': '‡§Ü', '‡§ø': '‡§á', '‡•Ä': '‡§à', '‡•Å': '‡§â', '‡•Ç': '‡§ä',
        '‡•É': '‡§ã', '‡•Ñ': '‡•†', '‡•¢': '‡§≤‡•É', '‡•£': '‡§≤‡•¢',
        '‡•á': '‡§è', '‡•à': '‡§ê', '‡•ã': '‡§ì', '‡•å': '‡§î'
    }

    independent_vowels = '‡§Ö‡§Ü‡§á‡§à‡§â‡§ä‡§ã‡•†‡§≤‡•É‡§≤‡•¢‡§è‡§ê‡§ì‡§î'

    res = []
    i = 0

    while i < len(text):
        char = text[i]

        # 1Ô∏è‚É£ ‡§∏‡•ç‡§µ‡§§‡§Ç‡§§‡•ç‡§∞ ‡§∏‡•ç‡§µ‡§∞
        if char in independent_vowels:
            res.append(char)
            i += 1
            continue

        # 2Ô∏è‚É£ ‡§µ‡•ç‡§Ø‡§Ç‡§ú‡§® (‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§∏‡§≤‡•Ä FIX ‡§π‡•à)
        elif '\u0915' <= char <= '\u0939' or char == '‡§≥':

            res.append(char + '‡•ç')
            i += 1

            vowel_added = False

            if i < len(text):
                # ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ
                if text[i] in vowels_map:
                    res.append(vowels_map[text[i]])
                    i += 1
                    vowel_added = True

                # ‡§π‡§≤‡§®‡•ç‡§§ ‚Üí ‡§ï‡•ã‡§à ‡§∏‡•ç‡§µ‡§∞ ‡§®‡§π‡•Ä‡§Ç
                elif text[i] == '‡•ç':
                    i += 1
                    vowel_added = True  # ‡§Ö ‡§Æ‡§§ ‡§ú‡•ã‡§°‡§º‡•ã

            # ‡§® ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ, ‡§® ‡§π‡§≤‡§®‡•ç‡§§ ‚Üí ‡§Ö
            if not vowel_added:
                res.append('‡§Ö')

            # ‡§Ö‡§Ø‡•ã‡§ó‡§µ‡§æ‡§π
            while i < len(text) and text[i] in '‡§Ç‡§É‡§Å':
                res.append(text[i])
                i += 1

            continue

        else:
            i += 1

    return res
