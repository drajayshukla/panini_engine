import streamlit as st
from core.phonology import sanskrit_varna_vichhed
from core.it_sanjna_engine import apply_halantyam

# рдкреЗрдЬ рд╕реЗрдЯрдЕрдк
st.set_page_config(page_title="рдЕрд╖реНрдЯрд╛рдзреНрдпрд╛рдпреА-рдпрдВрддреНрд░", layout="wide", initial_sidebar_state="expanded")

st.title("ЁЯХЙя╕П рдЕрд╖реНрдЯрд╛рдзреНрдпрд╛рдпреА-рдпрдВрддреНрд░ (The Paninian Engine)")
st.caption("рдПрдХ рдУрдкрди-рд╕реЛрд░реНрд╕ рдкрд╛рдгрд┐рдиреАрдп рд╡реНрдпрд╛рдХрд░рдг рдЗрдВрдЬрди | Developed by Dr. Ajay Shukla")

# рд╕рд╛рдЗрдбрдмрд╛рд░ рдореЗрдВ рд╡рд┐рдЬрди рдФрд░ рдорд┐рд╢рди
with st.sidebar:
    st.header("ЁЯОп рд╡рд┐рдЬрди рдФрд░ рдорд┐рд╢рди")
    st.write("рдкрд╛рдгрд┐рдиреА рдХреЗ рекрежрежреж рд╕реВрддреНрд░реЛрдВ рдХреЛ рдПрд▓реНрдЧреЛрд░рд┐рдердорд┐рдХ рд▓реЙрдЬрд┐рдХ рдореЗрдВ рд╕рдВрд╣рд┐рддрд╛рдмрджреНрдз рдХрд░рдирд╛ред")
    st.markdown("---")
    st.info("рдпрд╣ рдЗрдВрдЬрди рд╡рд░реНрддрдорд╛рди рдореЗрдВ 'рдЗрддреН-рд╕рдВрдЬреНрдЮрд╛' (Sutra 1.3.3) рддрдХ рд╡рд┐рдХрд╕рд┐рдд рд╣реИред")

# рдореБрдЦреНрдп рдЗрдВрдЯрд░рдлреЗрд╕
input_text = st.text_input("рд╕рдВрд╕реНрдХреГрдд рдЙрдкрджреЗрд╢ (рдзрд╛рддреБ/рдкреНрд░рддреНрдпрдп) рд▓рд┐рдЦреЗрдВ:", value="рд▓реНрдпреБрдЯреН")

if input_text:
    # 1. рд╡рд┐рдЪреНрдЫреЗрдж рдкреНрд░рдХреНрд░рд┐рдпрд╛
    varna_list = sanskrit_varna_vichhed(input_text)

    col1, col2 = st.columns(2)

    with col1:
        st.subheader("рез. рд╡рд░реНрдг-рд╡рд┐рдЪреНрдЫреЗрдж (Phonology)")
        st.code(" + ".join(varna_list), language=None)

    # 2. рдЗрддреН-рд╕рдВрдЬреНрдЮрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛
    remaining, its = apply_halantyam(varna_list.copy())

    with col2:
        st.subheader("реи. рдЗрддреН-рд╕рдВрдЬреНрдЮрд╛ (It-Sanjna)")
        if its:
            st.error(f"рд▓реЛрдк (рдЗрддреН рд╡рд░реНрдг): {' , '.join(its)}")
            st.markdown(f"**рд▓рд╛рдЧреВ рд╕реВрддреНрд░:** рез.рей.рей рд╣рд▓рдиреНрддреНрдпрдореН")
        else:
            st.warning("рдХреЛрдИ рдЗрддреН рд╡рд░реНрдг (рдЕрдВрддрд┐рдо рд╡реНрдпрдВрдЬрди) рдирд╣реАрдВ рдорд┐рд▓рд╛ред")

    st.markdown("---")
    st.subheader("ЁЯУК рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕рд╛рд░рд╛рдВрд╢ (Derivation Steps)")

    # рд╕реНрдЯреЗрдк-рдмрд╛рдп-рд╕реНрдЯреЗрдк рддрд╛рд▓рд┐рдХрд╛
    steps = [
        {"рдХреНрд░рдо": 1, "рдкреНрд░рдХреНрд░рд┐рдпрд╛": "рдореВрд▓ рд░реВрдк", "рд╕реНрдерд┐рддрд┐": input_text, "рд╕реВрддреНрд░": "-"},
        {"рдХреНрд░рдо": 2, "рдкреНрд░рдХреНрд░рд┐рдпрд╛": "рд╡рд░реНрдг-рд╡рд┐рдЪреНрдЫреЗрдж", "рд╕реНрдерд┐рддрд┐": " + ".join(varna_list), "рд╕реВрддреНрд░": "Phonology Rules"},
        {"рдХреНрд░рдо": 3, "рдкреНрд░рдХреНрд░рд┐рдпрд╛": "рд╣рд▓рдиреНрддреНрдпрдореН рд▓реЛрдк", "рд╕реНрдерд┐рддрд┐": " + ".join(remaining), "рд╕реВрддреНрд░": "рез.рей.рей рд╣рд▓рдиреНрддреНрдпрдореН"}
    ]
    st.table(steps)