import streamlit as st
from core.it_sanjna_engine import ItSanjnaEngine
from core.upadesha_registry import UpadeshaType

st.title("üß™ Sutra Practice Lab: ‡•ß.‡•©.‡•´ ‡§Ü‡§¶‡§ø‡§∞‡•ç‡§û‡§ø‡§ü‡•Å‡§°‡§µ‡§É")

st.markdown("""
‡§á‡§∏ ‡§≤‡•à‡§¨ ‡§Æ‡•á‡§Ç ‡§π‡§Æ **‡§ß‡§æ‡§§‡•Å ‡§ï‡•á ‡§Ü‡§¶‡§ø** ‡§Æ‡•á‡§Ç ‡§Ü‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§∏‡§Æ‡•Å‡§¶‡§æ‡§Ø‡•ã‡§Ç ‡§ï‡•Ä ‡§á‡§§‡•ç-‡§∏‡§Ç‡§ú‡•ç‡§û‡§æ ‡§ï‡§æ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡§ó‡•á‡•§
- **‡§û‡§ø** (Nyi) -> ‡§û‡•Ä‡§§‡•ç
- **‡§ü‡•Å** (Tu) -> ‡§ü‡•ç‡§µ‡§ø‡§§‡•ç
- **‡§°‡•Å** (Du) -> ‡§°‡•ç‡§µ‡§ø‡§§‡•ç
""")

# ‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§ß‡§æ‡§§‡•Å‡§ì‡§Ç ‡§ï‡§æ ‡§°‡•ç‡§∞‡•â‡§™‡§°‡§æ‡§â‡§®
lab_samples = {
    "‡§û‡§ø‡§Æ‡§ø‡§¶‡§æ‡§Å (‡§∏‡•ç‡§®‡•á‡§π‡§®‡•á)": "‡§û‡§ø‡§Æ‡§ø‡§¶‡§æ‡§Å",
    "‡§ü‡•Å‡§®‡§¶‡•Ä‡§Å (‡§∏‡§Æ‡•É‡§¶‡•ç‡§ß‡•å)": "‡§ü‡•Å‡§®‡§¶‡•Ä‡§Å",
    "‡§°‡•Å‡§ï‡•É‡§û‡•ç (‡§ï‡§∞‡§£‡•á)": "‡§°‡•Å‡§ï‡•É‡§û‡•ç",
    "‡§û‡§ø‡§ï‡•ç‡§∑‡•ç‡§µ‡§ø‡§¶‡§æ‡§Å (‡§∏‡•ç‡§®‡•á‡§π‡§®‡•á)": "‡§û‡§ø‡§ï‡•ç‡§∑‡•ç‡§µ‡§ø‡§¶‡§æ‡§Å",
    "‡§ü‡•Å‡§ï‡•ç‡§∑‡•Å (‡§∂‡§¨‡•ç‡§¶‡•á)": "‡§ü‡•Å‡§ï‡•ç‡§∑‡•Å"
}

selection = st.selectbox("‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ß‡§æ‡§§‡•Å ‡§ö‡•Å‡§®‡•á‡§Ç:", options=list(lab_samples.keys()))
input_val = lab_samples[selection]

if st.button("Analyze Sutra 1.3.5"):
    # ‡§á‡§Ç‡§ú‡§® ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç
    remaining, tags = ItSanjnaEngine.run_it_sanjna_prakaran(
        varna_list=sanskrit_varna_vichhed(input_val),  # ‡§Ü‡§™‡§ï‡§æ ‡§µ‡§ø‡§ö‡•ç‡§õ‡•á‡§¶ ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®
        original_input=input_val,
        source_type=UpadeshaType.DHATU
    )

    # ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Ç (Visual Trace)
    st.info(f"‡§Æ‡•Ç‡§≤ ‡§ß‡§æ‡§§‡•Å: {input_val}")
    st.success(f"‡§á‡§§‡•ç-‡§∏‡§Ç‡§ú‡•ç‡§û‡§æ ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§∂‡•á‡§∑: {''.join(remaining)}")
    for tag in tags:
        if "‡•ß.‡•©.‡•´" in tag:
            st.warning(f"üéØ Applied: {tag}")