import streamlit as st
import pandas as pd

# --- рез. рдкреЗрдЬ рд╕реЗрдЯрдЕрдк ---
st.set_page_config(page_title="Vibhakti Diagnostic Engine", layout="wide", page_icon="ЁЯФм")

# --- реи. рдбреЙрдХреНрдЯрд░ рд╕рд╛рд╣рдм рдХрд╛ 'Diagnostic Logic' рдбреЗрдЯрд╛рдмреЗрд╕ ---
LOGIC_RULES = {
    "рдкреНрд░рдердорд╛ рдПрдХрд╡рдЪрди": {
        "symptoms": ["рд╕реНрд╡рд░ рдЕрдВрдд", "рд╡реНрдпрдВрдЬрди рдЕрдВрдд", "рд╡рд┐рд╕рд░реНрдЧ рдЕрдВрдд (рдГ)"],
        "examples": "рд░рд╛рдордГ, рд╣рд░рд┐рдГ, рдЧреБрд░реБрдГ, рдкрд┐рддрд╛, рднрдЧрд╡рд╛рдиреН, рдЖрддреНрдорд╛, рд░рд╛рдЬрд╛, рднрд╡рд╛рдиреН, рдЧреМрдГ, рдзреЗрдиреБрдГ, рд╢реНрд░реАрдГ, рд▓рдХреНрд╖реНрдореАрдГ, рдорддрд┐рдГ, рдирджреА, рд╡рд╛рдХреН, рд╡рдзреВрдГ, рд░рдорд╛, рдорд╛рддрд╛, рднрд╡рддреА, рдмреНрд░рд╣реНрдо, рдирд╛рдо, рдордирдГ, рдлрд▓рдореН"
    },
    "рдкреНрд░рдердорд╛ рджреНрд╡рд┐рд╡рдЪрди": {
        "symptoms": ["рдЖ рдЕрдВрдд", "рдИ рдЕрдВрдд", "рдФ рдЕрдВрдд", "рдП рдЕрдВрдд"],
        "examples": "рд░рд╛рдореМ, рд╣рд░реА, рдЧреБрд░реВ, рдкрд┐рддрд░реМ, рднрдЧрд╡рдиреНрддреМ, рдЖрддреНрдорд╛рдиреМ, рд░рд╛рдЬрд╛рдиреМ, рднрд╡рдиреНрддреМ, рдЧрд╛рд╡реМ, рдзреЗрдиреНрд╡реМ, рд╢реНрд░рд┐рдпреМ, рд▓рдХреНрд╖реНрдореНрдпреМ, рдорддреНрдпреМ, рдирджреНрдпреМ, рд╡рд╛рдЪреМ, рд░рдореЗ, рдорд╛рддрд░реМ, рдлрд▓реЗ"
    },
    "рдкреНрд░рдердорд╛ рдмрд╣реБрд╡рдЪрди": {
        "symptoms": ["рд╡рд┐рд╕рд░реНрдЧ рдЕрдВрдд (рдГ)", "рд╡рд┐рд╕рд░реНрдЧ рдкреВрд░реНрд╡ рд▓рдШреБ рд╕реНрд╡рд░", "ni / si рдЕрдВрдд"],
        "examples": "рд░рд╛рдорд╛рдГ, рд╣рд░рдпрдГ, рдЧреБрд░рд╡рдГ, рдкрд┐рддрд░рдГ, рднрдЧрд╡рдиреНрддрдГ, рдЖрддреНрдорд╛рдирдГ, рд░рд╛рдЬрд╛рдирдГ, рдЧрд╛рд╡рдГ, рдзреЗрдирд╡рдГ, рдмреНрд░рд╣реНрдорд╛рдгрд┐, рдирд╛рдорд╛рдирд┐, рдордирд╛рдВрд╕рд┐, рдлрд▓рд╛рдирд┐"
    },
    "рджреНрд╡рд┐рддреАрдпрд╛ рдмрд╣реБрд╡рдЪрди": {
        "symptoms": ["aan", "iin", "uun", "reen"],
        "examples": "рд░рд╛рдорд╛рдиреН, рд╣рд░реАрдиреН, рдЧреБрд░реВрдиреН, рдкрд┐рддреДрдиреН, рдзреЗрдиреВрдиреН, рдорддреАрдГ, рдирджреАрдГ, рд░рдорд╛рдГ, рдорд╛рддреДрдиреН, рднрд╡рддреАрдГ, рдпреБрд╖реНрдорд╛рдиреН, рдЕрд╕реНрдорд╛рдиреН"
    },
    "рддреГрддреАрдпрд╛ рдПрдХрд╡рдЪрди": {
        "symptoms": ["рдПрдг / рдг / рдирд╛ рдЕрдВрдд", "рдЖ / рдпрд╛ / рддреНрд░рд╛ рдЕрдВрдд", "рддрд╛ / рд╡рд╛рдЪрд╛ / рд╕рд╛ рдЕрдВрдд"],
        "examples": "рд░рд╛рдореЗрдг, рд╣рд░рд┐рдгрд╛, рдЧреБрд░реБрдгрд╛, рдкрд┐рддреНрд░рд╛, рднрдЧрд╡рддрд╛, рдЖрддреНрдордирд╛, рдЧрд╡рд╛, рдзреЗрдиреНрд╡рд╛, рд╢реНрд░рд┐рдпрд╛, рдирджреНрдпрд╛, рд╡рд╛рдЪрд╛, рд╡рдзреНрд╡рд╛, рд░рдордпрд╛, рдорд╛рддреНрд░рд╛, рдордирд╕рд╛, рдлрд▓реЗрди, рддреНрд╡рдпрд╛, рдордпрд╛"
    },
    "рдЪрддреБрд░реНрдереА рдПрдХрд╡рдЪрди": {
        "symptoms": ["рдЖрдп", "рдпреЗ / рд╡реЗ / рддреЗ / рдиреЗ / рдЬреНрдЮреЗ / рддреНрд░реЗ / рдгреЗ", "рдЪреЗ", "рдпреИ / рд╡реИ / рд╕реНрдореИ", "рдЕрдореН"],
        "examples": "рд░рд╛рдорд╛рдп, рд╣рд░рдпреЗ, рдЧреБрд░рд╡реЗ, рдкрд┐рддреНрд░реЗ, рднрдЧрд╡рддреЗ, рдЖрддреНрдордиреЗ, рд░рд╛рдЬреНрдЮреЗ, рдЧреЛрд╡реЗ, рд╢реНрд░рд┐рдпреИ, рд▓рдХреНрд╖реНрдореНрдпреИ, рдорддреНрдпреИ, рд╡рдзреНрд╡реИ, рд░рдореИ, рдорд╛рддреНрд░реЗ, рдЕрд╕реНрдореИ, рддреБрднреНрдпрдореН, рдорд╣реНрдпрдореН"
    },
    "рд╖рд╖реНрдареА рдПрдХрд╡рдЪрди": {
        "symptoms": ["рд╕реНрдп", "рд╡рд┐рд╕рд░реНрдЧ рдЕрдВрдд (-рдЕрдГ, -рдУрдГ, -рдЖрдГ, -рдпрд╛рдГ)", "рдЪрдГ / рдЙрдГ / рдирдГ / рд╕рдГ"],
        "examples": "рд░рд╛рдорд╕реНрдп, рд╣рд░реЗрдГ, рдЧреБрд░реЛрдГ, рдкрд┐рддреБрдГ, рднрдЧрд╡рддрдГ, рдЖрддреНрдордирдГ, рд░рд╛рдЬреНрдЮрдГ, рднрд╡рддрдГ, рдЧреЛрдГ, рдзреЗрдиреЛрдГ, рд╢реНрд░рд┐рдпрд╛рдГ, рдирджреНрдпрд╛рдГ, рд░рдорд╛рдпрд╛рдГ, рдорд╛рддреБрдГ, рдмреНрд░рд╣реНрдордгрдГ, рдирд╛рдореНрдирдГ, рдлрд▓рд╕реНрдп, рддрд╕реНрдп, рдордо"
    },
    "рд╕рдкреНрддрдореА рдПрдХрд╡рдЪрди": {
        "symptoms": ["рдП", "рдФ", "рд░рд┐ / рддрд┐ / рдирд┐ / рд╡рд┐ / рдпрд┐ / рдЪрд┐ / рд╕рд┐", "рдпрд╛рдореН / рд╡рд╛рдореН"],
        "examples": "рд░рд╛рдореЗ, рд╣рд░реМ, рдЧреБрд░реМ, рдкрд┐рддрд░рд┐, рднрдЧрд╡рддрд┐, рдЖрддреНрдордирд┐, рд░рд╛рдЬрдирд┐, рдзреЗрдиреМ, рд╢реНрд░рд┐рдпрд┐, рд▓рдХреНрд╖реНрдореНрдпрд╛рдореН, рдирджреНрдпрд╛рдореН, рд╡рд╛рдЪрд┐, рд░рдорд╛рдпрд╛рдореН, рдорд╛рддрд░рд┐, рдмреНрд░рд╣реНрдордгрд┐, рдордирд╕рд┐, рдлрд▓реЗ, рдЕрд╕реНрдорд┐рдиреН, рддреНрд╡рдпрд┐, рдордпрд┐"
    }
}


def main():
    st.title("ЁЯФм Clinical Vibhakti Diagnostic Engine")
    st.caption("рдбреЙ. рдЕрдЬрдп рд╢реБрдХреНрд▓рд╛ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рддрд┐рдкрд╛рджрд┐рдд 'Suffix Logic' рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдкрд╣рдЪрд╛рди рдкреНрд░рдгрд╛рд▓реА")

    # --- рей. рд╕рд┐рд▓реЗрдХреНрд╢рди рдЗрдВрдЯрд░рдлреЗрд╕ (The Tick Options) ---
    st.sidebar.header("ЁЯФН рд▓рдХреНрд╖рдг (Symptoms)")
    selected_symptoms = []

    # рд╕рднреА рд▓рдХреНрд╖рдгреЛрдВ рдХреА рдПрдХ рдорд╛рд╕реНрдЯрд░ рд▓рд┐рд╕реНрдЯ рдмрдирд╛рдирд╛
    all_symptoms = set()
    for v in LOGIC_RULES.values():
        all_symptoms.update(v["symptoms"])

    for symptom in sorted(list(all_symptoms)):
        if st.sidebar.checkbox(symptom):
            selected_symptoms.append(symptom)

    # --- рек. рдбрд╛рдпрдЧреНрдиреЛрд╕реНрдЯрд┐рдХ рд▓реЙрдЬрд┐рдХ ---
    diagnoses = []
    for vibhakti, info in LOGIC_RULES.items():
        # рдпрджрд┐ рдЪреБрдирд╛ рдЧрдпрд╛ рдХреЛрдИ рднреА рд▓рдХреНрд╖рдг рдЗрд╕ рд╡рд┐рднрдХреНрддрд┐ рдХреЗ рд▓рдХреНрд╖рдгреЛрдВ рдореЗрдВ рд╣реИ
        match_count = len(set(selected_symptoms) & set(info["symptoms"]))
        if match_count > 0:
            diagnoses.append({
                "рд╕рдВрднрд╛рд╡рд┐рдд рд╡рд┐рднрдХреНрддрд┐": vibhakti,
                "рд▓рдХреНрд╖рдг рдореИрдЪ": match_count,
                "рдЖрдкрдХреЗ рдЙрджрд╛рд╣рд░рдг": info["examples"]
            })

    # --- рел. рдкрд░рд┐рдгрд╛рдо рдкреНрд░рджрд░реНрд╢рди ---
    if not selected_symptoms:
        st.warning("ЁЯСИ рдмрд╛рдИрдВ рдУрд░ рд╕реЗ рд░реВрдк рдХреЗ рд▓рдХреНрд╖рдгреЛрдВ (Suffix Characteristics) рдХреЛ рдЯрд┐рдХ рдХрд░реЗрдВред")
    else:
        st.subheader("ЁЯОп Differential Diagnosis")

        for d in diagnoses:
            with st.expander(f"тЬЕ {d['рд╕рдВрднрд╛рд╡рд┐рдд рд╡рд┐рднрдХреНрддрд┐']}"):
                st.write(f"**рдореИрдЪрд┐рдВрдЧ рдХреНрд░рд╛рдЗрдЯреЗрд░рд┐рдпрд╛:** {match_count} рд▓рдХреНрд╖рдг рдорд┐рд▓реЗ")
                st.markdown(f"**рд╢рд╛рд╕реНрддреНрд░реАрдп рдЙрджрд╛рд╣рд░рдг:**")
                st.info(d["рдЖрдкрдХреЗ рдЙрджрд╛рд╣рд░рдг"])

    # --- рем. рд╡рд┐рдЬрд╝реБрдЕрд▓рд╛рдЗрдЬрд╝реЗрд╢рди ---
    st.divider()
    st.subheader("ЁЯзм рд╡реНрдпрд╛рдХрд░рдгрд┐рдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ (Clinical Flow)")
    st.write("рдкреНрд░рддреНрдпрдп рдФрд░ рдкреНрд░рд╛рддрд┐рдкрджрд┐рдХ рдХреЗ рд╕рдВрдпреЛрдЧ рд╕реЗ рдЙрддреНрдкрдиреНрди рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдзреНрд╡рдирд┐-рд╡рд┐рдХрд╛рд░реЛрдВ (Sound Patterns) рдХрд╛ рдЪрд╛рд░реНрдЯ:")


if __name__ == "__main__":
    main()