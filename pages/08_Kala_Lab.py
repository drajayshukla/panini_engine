import streamlit as st
from core.phonology import sanskrit_varna_vichhed
from logic.kala_rules import apply_ukalo_aj_1_2_27

# --- рез. рдкреЗрдЬ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди ---
st.set_page_config(page_title="Kala-Sanjna Lab", layout="wide", page_icon="тП│")
st.title("тП│ рд╕реНрд╡рд░-рдХрд╛рд▓ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдкреНрд░рдпреЛрдЧрд╢рд╛рд▓рд╛ (SK6 Lab)")
st.caption("рдирд┐рдпрдо: рдКрдХрд╛рд▓реЛрд╜рдЬреНрдЭреНрд░рд╕реНрд╡рджреАрд░реНрдШрдкреНрд▓реБрддрдГ (рез.реи.реирен) рдПрд╡рдВ рд╡рд░реНрдг-рд╕реНрд╡рднрд╛рд╡ рдирд┐рдпрдо")

# --- реи. рдпреВрдЬрд░ рдЗрдирдкреБрдЯ ---
input_text = st.text_input("рд╕рдВрд╕реНрдХреГрдд рд╢рдмреНрдж рд▓рд┐рдЦреЗрдВ (рдЙрджрд╛. рд░рд╛рдо, рдМрдХрд╛рд░, рдУрейрдореН):", value="рдМрдХрд╛рд░")

if input_text:
    # рд╡рд┐рдЪреНрдЫреЗрдж рдФрд░ рд╕рдВрдЬреНрдЮрд╛ рдирд┐рдпрдо рд▓рд╛рдЧреВ рдХрд░рдирд╛
    varna_objects = sanskrit_varna_vichhed(input_text)
    processed_varnas = [apply_ukalo_aj_1_2_27(v) for v in varna_objects]

    # --- рей. рд╡рд┐рдЬрд╝реБрдЕрд▓ рдЖрдЙрдЯрдкреБрдЯ ---
    st.subheader(f"ЁЯФН рд╢рдмреНрдж рд╡рд┐рд╢реНрд▓реЗрд╖рдг: {input_text}")

    cols = st.columns(len(processed_varnas))

    for i, v in enumerate(processed_varnas):
        with cols[i]:
            # рдХрд╛рд░реНрдб рдЬреИрд╕рд╛ рдбрд┐рдЬрд╝рд╛рдЗрди
            color = "#FFEBEE" if v.kala_sanjna == "рд╡реНрдпрдЮреНрдЬрди" else "#E8F5E9"
            border = "#D32F2F" if v.kala_sanjna == "рд╡реНрдпрдЮреНрдЬрди" else "#2E7D32"

            st.markdown(f"""
                <div style="background-color:{color}; border:2px solid {border}; border-radius:10px; padding:10px; text-align:center;">
                    <h2 style="margin:0; color:black;">{v.char}</h2>
                    <p style="margin:5px 0; font-size:0.9rem; color:#666;">{v.kala_sanjna}</p>
                    <b style="color:{border};">{v.matra} рдорд╛рддреНрд░рд╛</b>
                </div>
            """, unsafe_allow_html=True)

    # --- рек. рдкрд╛рдгрд┐рдиреАрдп рдирд┐рдпрдо рдЪреЗрдХрд░ (The Medical Report) ---
    st.divider()
    st.subheader("ЁЯУЛ рдкрд╛рдгрд┐рдиреАрдп рдирд┐рдпрдо рдЕрдиреБрдкрд╛рд▓рди рд░рд┐рдкреЛрд░реНрдЯ (Audit Log)")

    for v in processed_varnas:
        if v.is_vowel:
            # рдирд┐рдпрдо реи: рдМ-рдХрд╛рд░ (рджреАрд░реНрдШрд╛рднрд╛рд╡)
            if 'рдМ' in v.char and v.matra == 2:
                st.error(f"тЪая╕П рдирд┐рдпрдо рдЙрд▓реНрд▓рдВрдШрди: рд╡рд░реНрдг '{v.char}' рдХрд╛ рджреАрд░реНрдШ рднреЗрдж рдирд╣реАрдВ рд╣реЛрддрд╛ред (рез.реи.реирен рдХреЗ рдЕрдиреБрд╕рд╛рд░)")
            elif 'рдМ' in v.char:
                st.success(f"тЬЕ рдирд┐рдпрдо реи рдкрд╛рд▓рди: '{v.char}' рдХреЗрд╡рд▓ рд╣реНрд░рд╕реНрд╡/рдкреНрд▓реБрдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИред (рдпрд╣рд╛рдБ: {v.kala_sanjna})")

            # рдирд┐рдпрдо рей: рдПрдЪ (рдП, рдУ, рдР, рдФ - рд╣реНрд░рд╕реНрд╡рд╛рднрд╛рд╡)
            if v.char in ['рдП', 'рдУ', 'рдР', 'рдФ'] and v.matra == 1:
                st.error(f"тЪая╕П рдирд┐рдпрдо рдЙрд▓реНрд▓рдВрдШрди: рд╡рд░реНрдг '{v.char}' рдХрд╛ рд╣реНрд░рд╕реНрд╡ рднреЗрдж рдирд╣реАрдВ рд╣реЛрддрд╛ред")
            elif v.char in ['рдП', 'рдУ', 'рдР', 'рдФ']:
                st.success(f"тЬЕ рдирд┐рдпрдо рей рдкрд╛рд▓рди: '{v.char}' рд╣рдореЗрд╢рд╛ рджреАрд░реНрдШ/рдкреНрд▓реБрдд рд╣реЛрддрд╛ рд╣реИред (рдпрд╣рд╛рдБ: {v.kala_sanjna})")

            # рдирд┐рдпрдо рез: рдЕ, рдЗ, рдЙ, рдЛ (рд╕рд░реНрд╡рд╛рд╡рд╕реНрдерд╛)
            if v.char[0] in ['рдЕ', 'рдЗ', 'рдЙ', 'рдЛ']:
                st.success(f"тЬЕ рдирд┐рдпрдо рез рдкрд╛рд▓рди: '{v.char}' рдХреЗ рд╣реНрд░рд╕реНрд╡, рджреАрд░реНрдШ, рдкреНрд▓реБрдд рддреАрдиреЛрдВ рд╕рдВрднрд╡ рд╣реИрдВред")

# --- рел. рд╕рдВрджрд░реНрдн рдЪрд┐рддреНрд░ рдПрд╡рдВ рдЪрд╛рд░реНрдЯ ---
st.divider()
st.markdown("### ЁЯУЪ рд╕рдВрджрд░реНрдн")

st.info("""
- **рдирд┐рдпрдо рез:** рдЕ, рдЗ, рдЙ, рдЛ (резрео рднреЗрдж) - рд╣реНрд░рд╕реНрд╡, рджреАрд░реНрдШ, рдкреНрд▓реБрдд рддреАрдиреЛрдВред
- **рдирд┐рдпрдо реи:** рдМ (резреи рднреЗрдж) - рджреАрд░реНрдШ рдХрд╛ рдЕрднрд╛рд╡ред
- **рдирд┐рдпрдо рей:** рдП, рдУ, рдР, рдФ (резреи рднреЗрдж) - рд╣реНрд░рд╕реНрд╡ рдХрд╛ рдЕрднрд╛рд╡ред
""")